https://www.techpit.jp/courses/78/curriculums/81/sections/621/parts/2153

## 【補足】AWSリソースの削除について

本教材を完了して、作成したAWSリソースを全て削除したい方は以下の内容を参考にしてください。

削除順序によっては削除できない場合が発生しますので、基本的に最後に作成したものから順にさかのぼって削除していくようにしてください。

## 1. 7章で作成したAWSリソースの削除

### 1.1. CodePipelineのlaravel-ciパイプライン

- CodePipelineの画面へ
- `パイプライン`メニューで`laravel-ci`のラジオボタンをチェック
- `パイプラインを削除する`を選択
- Amazon CloudWatch Eventsルールを同時削除して良いかの確認が出るが、削除して構わないので`このソースアクションの変更にリソースの更新は必要ありません`にチェックはせずに`削除`を選択

注：この同時削除するAmazon CloudWatch Eventsルールは、CodeCommitの`laravel-ci`リポジトリへのプッシュを検出するために使用されているものです

### 1.2. CodePipelineのサービスロール

- IAMの画面へ
- `ロール`メニューで`AWSCodePipelineServiceRole-ap-northeast-1-laravel-ci`のラジオボタンをチェック
- `ロールの削除`を選択
- 確認画面が出るので、画面の指示通りに削除する

### 1.3. CodeBuildのlaravel-ciビルドプロジェクト

- CodeBuildの画面へ
- `ビルドプロジェクト`メニューで`laravel-ci`のラジオボタンをチェック
- `ビルドプロジェクトの削除`を選択
- 確認画面が出るので`削除`を選択

### 1.4. CodeBuildのサービスロール

- IAMの画面へ
- `ロール`メニューで`codebuild-laravel-ci-service-role`のラジオボタンをチェック
- `ロールの削除`を選択
- 確認画面が出るので、画面の指示通りに削除する

### 1.5. CodeCommitのlaravel-ciリポジトリ

- CodeBuildの画面へ
- `リポジトリ`メニューで`laravel-ci`のラジオボタンをチェック
- `リポジトリの削除`を選択
- 確認画面が出るので`削除`を選択

### 1.6. CodePipeline用のS3バケット

CodePipeline用のS3バケットは、本教材以外でCodePipelineを作っている場合、共用されている可能性があります。

この場合は、バケット内の`laravel-ci`フォルダのみ削除することをおすすめします。

- S3の画面へ

- `バケット`メニューで`codepipeline-ap-northeast-1`で検索

- ```
  laravel-ci
  ```

  フォルダのみ削除する場合は以下

  - 表示されたバケット名を選択
  - `laravel-ci`フォルダのチェックボックスをチェック
  - `アクション` > `削除`を選択

- バケットごと削除する場合は以下

  - 表示されたバケットのラジオボタンをチェック
  - `空にする`を選択し、確認画面で`空にする`を選択
  - `削除`を選択し、確認画面で`バケットを削除する`を選択

### 1.7. CloudWatch LogsのCodeBuildのログ

- CloudWatchの画面へ
- `ロググループ`メニューで`/aws/codebuild/laravel-ci`のラジオボタンをチェック
- `アクション` > `ロググループの削除`を選択

### 1.8. IAMユーザーlaravel-ci-codecommit-pusher

- IAMの画面へ
- `ユーザー`メニューで`laravel-ci-codecommit-pusher`のラジオボタンをチェック
- `ユーザーの削除`を選択
- 確認画面が出るので、画面の指示通りに削除する

## 2. 6章で作成したAWSリソースの削除

### 2.1. AWS Chatbotのlaravel_ci_deployチャネル

- AWS Chatbotの画面へ
- `設定済みクラインアント`から、あなたのSlackワークスペースの名前のものを選択
- 設定済みチャネルから、`laravel_ci_デプロイ`のラジオボタンをチェック
- `削除`を選択
- 確認画面が出るので、画面の指示通りに削除する

### 2.2. SNSのlaravel-ciトピック

- Amazon SNSの画面へ
- `トピック`メニューから、`laravel-ci-deploy`のラジオボタンをチェック
- `削除`を選択
- 確認画面が出るので、画面の指示通りに削除する

### 2.3. IAMユーザーlaravel-ci-deployer

- IAMの画面へ
- `ユーザー`メニューで`laravel-ci-deployer`のラジオボタンをチェック
- `ユーザーの削除`を選択
- 確認画面が出るので、画面の指示通りに削除する

### 2.4. IAMロールlaravel-ci-ec2

- IAMの画面へ
- `ロール`メニューで`laravel-ci-ec2`のラジオボタンをチェック
- `ロールの削除`を選択
- 確認画面が出るので、画面の指示通りに削除する

### 2.5. CodeDeployのlaravel-ciアプリケーションの削除

- CodeDeployの画面へ
- `アプリケーション`メニューで`laravel-ci`の名前の部分を選択
- `laravel-ci`アプリケーションの詳細画面で`アプリケーションの削除`を選択
- 確認画面が出るので、画面の指示通りに削除する

`laravel-ci`アプリケーションを削除すると、`laravel-ci`デプロイグループも削除されます。

### 2.6. CodeDeploy用のS3バケットの削除

- S3の画面へ
- `バケット`メニューで`laravel-ci-codedeploy-ap-northeast-1`で検索
- 表示されたバケットのラジオボタンをチェック
- `空にする`を選択し、確認画面で`空にする`を選択
- 確認画面が出るので、画面の指示通りに削除する

## 3. 4章で作成したAWSリソースの削除

### 3.1 RDSの削除

- RDSの画面へ
- `データベース`メニューで`laravel-ci`のラジオボタンをチェック
- `アクション` > `削除`を選択
- 確認画面が表示される
- `最終スナップショットを作成しますか?`のチェックを外す
- `インスタンスの削除後、システムスナップショットとポイントインタイムの復元を含む自動バックアップが利用不可となることを了承しました。`のチェックを入れる
- あとは画面の指示通りに削除する

### 3.2. CloudFormationのlaravel-ciスタック

この一つ前のRDS`laravel-ci`の削除が完全に終わってから(RDSの画面に表示されなくなってから)`laravel-ci`スタックの削除を開始するようにしてください。

- CloudFormationの画面へ
- `laravel-ci`スタックのラジオボタンをチェック
- `削除`を選択
- 確認画面が出るので、画面の指示通りに削除する

これにより、教材で使用した以下のリソースが削除されます。

- VPC
- サブネット(パブリック * 1、プライベート * 2)
- DBサブネットグループ
- ルートテーブル
- インターネットゲートウェイ
- セキュリティグループ(パブリックサーバー用 * 1、プライベートサーバー用 * 1)
- ElasticIP
- EC2

### 3.3. EC2のキーペア

- EC2の画面へ
- `キーペア`メニューで`laravel-ci-ec2-user`のチェックボックスをチェック
- `アクション` > `削除`を選択
- 確認画面が出るので、画面の指示通りに削除する